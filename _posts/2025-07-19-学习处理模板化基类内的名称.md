---
layout: post
title: Effective C++ æ¡æ¬¾43ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°
categories: [é˜…è¯»ç¬”è®°, Effective C++]
tag: [Effective C++]
date: '2025-07-19 01:28:29 +0800'
---

## **Effective C++ æ¡æ¬¾43 ï¼šå­¦ä¹ å¤„ç†æ¨¡æ¿åŒ–åŸºç±»å†…çš„åç§°**

---

<br/>

### âš™ï¸ **ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šç¼–è¯‘å™¨ä¸ºä½•æ— æ³•è¯†åˆ«åŸºç±»æˆå‘˜ï¼Ÿ**

#### **åœºæ™¯ç¤ºä¾‹**

å‡è®¾éœ€å®ç°ä¸€ä¸ªæ¶ˆæ¯å‘é€ç³»ç»Ÿï¼Œæ”¯æŒä¸åŒå…¬å¸çš„åŠ å¯†/æ˜æ–‡å‘é€æ¥å£ï¼š
```cpp
class CompanyA { // å…¬å¸Açš„æ¥å£
public:
    void sendCleartext(const std::string& msg);
    void sendEncrypted(const std::string& msg);
};

template<typename Company>
class MsgSender { // æ¨¡æ¿åŒ–åŸºç±»
public:
    void sendClear(const MsgInfo& info) {
        std::string msg;
        Company c;
        c.sendCleartext(msg); // è°ƒç”¨å…¬å¸æ¥å£
    }
};

template<typename Company>
class LoggingMsgSender : public MsgSender<Company> { // æ´¾ç”Ÿç±»æ¨¡æ¿
public:
    void sendClearMsg(const MsgInfo& info) {
        // æ—¥å¿—è®°å½•
        sendClear(info); // é”™è¯¯ï¼ç¼–è¯‘å™¨æç¤º sendClear ä¸å­˜åœ¨
        // æ—¥å¿—è®°å½•
    }
};
```
**é—®é¢˜åˆ†æ**ï¼š  
å½“ç¼–è¯‘å™¨è§£æ `LoggingMsgSender` å®šä¹‰æ—¶ï¼š  
1. **åŸºç±»æœªå…·è±¡åŒ–**ï¼š`MsgSender<Company>` ä¸­çš„ `Company` æ˜¯æ¨¡æ¿å‚æ•°ï¼Œå°šæœªå®ä¾‹åŒ–ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®è®¤å…¶å…·ä½“ç±»å‹ã€‚  
2. **ç‰¹åŒ–ç‰ˆæœ¬é£é™©**ï¼šåŸºç±»æ¨¡æ¿å¯èƒ½è¢«ç‰¹åŒ–ï¼ˆå¦‚ `MsgSender<CompanyZ>`ï¼‰ï¼Œç‰¹åŒ–ç‰ˆæœ¬å¯èƒ½ä¸æä¾› `sendClear` æ¥å£ï¼Œç¼–è¯‘å™¨éœ€ä¿å®ˆå‡è®¾åŸºç±»æ— æ­¤æˆå‘˜ã€‚

---

### ğŸ” **äºŒã€è§£å†³æ–¹æ¡ˆï¼šå¼ºåˆ¶ç¼–è¯‘å™¨æŸ¥æ‰¾åŸºç±»åç§°**

#### **1. ä½¿ç”¨ `this->` å‰ç¼€**  
åœ¨æ´¾ç”Ÿç±»ä¸­é€šè¿‡ `this->` æ˜¾å¼æŒ‡å®šæˆå‘˜ä½äºå½“å‰ç±»æˆ–åŸºç±»ä½œç”¨åŸŸï¼š  
```cpp
template<typename Company>
class LoggingMsgSender : public MsgSender<Company> {
public:
    void sendClearMsg(const MsgInfo& info) {
        this->sendClear(info); // æ­£ç¡®ï¼ç¼–è¯‘å™¨å‡è®¾åŸºç±»å­˜åœ¨ sendClear
    }
};
```  
**åŸç†**ï¼š`this->` å‘ŠçŸ¥ç¼–è¯‘å™¨åœ¨å®ä¾‹åŒ–æ—¶å†æŸ¥æ‰¾åç§°ï¼Œæ­¤æ—¶åŸºç±»å·²å…·è±¡åŒ–ã€‚

#### **2. ä½¿ç”¨ `using` å£°æ˜å¼**  
å°†åŸºç±»æˆå‘˜å¼•å…¥æ´¾ç”Ÿç±»ä½œç”¨åŸŸï¼š  
```cpp
template<typename Company>
class LoggingMsgSender : public MsgSender<Company> {
public:
    using MsgSender<Company>::sendClear; // æ˜¾å¼å¼•å…¥åç§°
    void sendClearMsg(const MsgInfo& info) {
        sendClear(info); // æ­£ç¡®ï¼
    }
};
```  
**é€‚ç”¨åœºæ™¯**ï¼šè§£å†³åç§°è¢«æ´¾ç”Ÿç±»åŒåæˆå‘˜é®æ©çš„é—®é¢˜ï¼ˆç±»ä¼¼æ¡æ¬¾33ï¼‰ï¼ŒåŒæ—¶é€‚ç”¨äºæ¨¡æ¿åŸºç±»ã€‚

#### **3. ä½¿ç”¨åŸºç±»é™å®šç¬¦**  
ç›´æ¥æŒ‡å®šåŸºç±»ä½œç”¨åŸŸï¼š  
```cpp
template<typename Company>
class LoggingMsgSender : public MsgSender<Company> {
public:
    void sendClearMsg(const MsgInfo& info) {
        MsgSender<Company>::sendClear(info); // æ­£ç¡®ï¼Œä½†å¯èƒ½å…³é—­è™šå‡½æ•°ç»‘å®š
    }
};
```  
**ç¼ºç‚¹**ï¼š  
- è‹¥ `sendClear` æ˜¯è™šå‡½æ•°ï¼Œæ˜¾å¼é™å®šä¼šå…³é—­å¤šæ€æœºåˆ¶ï¼ˆé™æ€ç»‘å®šï¼‰ã€‚  
- ä»£ç å†—ä½™ä¸”çµæ´»æ€§é™ä½ã€‚

---

### ğŸ’¡ **ä¸‰ã€è§£å†³æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰æ‹©**

| **æ–¹æ³•**     | **ä¼˜ç‚¹**           | **ç¼ºç‚¹**                 | **é€‚ç”¨åœºæ™¯**                 |
| ------------ | ------------------ | ------------------------ | ---------------------------- |
| `this->`     | ç®€æ´ï¼Œå…¼å®¹è™šå‡½æ•°   | éœ€ä¿®æ”¹æ‰€æœ‰è°ƒç”¨ç‚¹         | å¤šæ•°æƒ…å†µé¦–é€‰                 |
| `using` å£°æ˜ | ä¸€æ¬¡å£°æ˜ï¼Œå¤šå¤„ä½¿ç”¨ | å¯èƒ½å¼•å…¥ä¸éœ€è¦çš„åç§°     | éœ€è§£å†³åç§°é®æ©æˆ–æ‰¹é‡å¼•å…¥     |
| åŸºç±»é™å®šç¬¦   | æ˜ç¡®æŒ‡å®šä½œç”¨åŸŸ     | å…³é—­è™šå‡½æ•°å¤šæ€ï¼›ä»£ç å†—ä½™ | éè™šå‡½æ•°æˆ–ç¡®å®šä¸éœ€å¤šæ€çš„åœºæ™¯ |

**æ ¸å¿ƒåŸåˆ™**ï¼š  
> å‘ç¼–è¯‘å™¨æ‰¿è¯º **â€œåŸºç±»æ¨¡æ¿çš„ä»»ä½•ç‰¹åŒ–ç‰ˆæœ¬éƒ½æ”¯æŒæ³›åŒ–ç‰ˆæœ¬æ¥å£â€** ã€‚  
> ç¼–è¯‘å™¨åœ¨æ´¾ç”Ÿç±»æ¨¡æ¿è§£æé˜¶æ®µä¿å®ˆæ‹’ç»æŸ¥æ‰¾åŸºç±»åç§°ï¼Œä¸‰ç§æ–¹æ³•å‡é€šè¿‡å»¶è¿ŸæŸ¥æ‰¾è‡³å®ä¾‹åŒ–æ—¶è§£å†³è¯¥é—®é¢˜ã€‚

---

### âš ï¸ **å››ã€æ½œåœ¨é™·é˜±ï¼šæ¨¡æ¿å…¨ç‰¹åŒ–ç ´åæ¥å£**

è‹¥åŸºç±»æ¨¡æ¿è¢«å…¨ç‰¹åŒ–ä¸”æœªå®ç°é€šç”¨æ¥å£ï¼Œæ´¾ç”Ÿç±»è°ƒç”¨å°†å¤±è´¥ï¼š  
```cpp
template<>
class MsgSender<CompanyZ> { // å…¨ç‰¹åŒ–ç‰ˆæœ¬
public:
    void sendSecret(const MsgInfo& info); // æœªå®ç° sendClearï¼
};

LoggingMsgSender<CompanyZ> sender; 
sender.sendClearMsg(info); // è¿è¡Œæ—¶é”™è¯¯ï¼šåŸºç±»æ—  sendClear
```  
**å¯ç¤º**ï¼š  
- æ´¾ç”Ÿç±»è®¾è®¡éœ€ä¸åŸºç±»æ³›å‹æ¥å£çº¦å®šä¸€è‡´ï¼Œé¿å…ä¾èµ–å¯èƒ½è¢«ç‰¹åŒ–ç ´åçš„æ¥å£ã€‚  
- æ–‡æ¡£ä¸­æ˜ç¡®å£°æ˜åŸºç±»æ¨¡æ¿çš„æ¥å£çº¦æŸã€‚

---

### ğŸ’ **äº”ã€æœ€ä½³å®è·µæ€»ç»“**

1. **ä¼˜å…ˆä½¿ç”¨ `this->`**ï¼š  
   åœ¨æ´¾ç”Ÿç±»æ¨¡æ¿ä¸­é€šè¿‡ `this->` è°ƒç”¨åŸºç±»æˆå‘˜ï¼Œå…¼é¡¾ç®€æ´æ€§å’Œå¤šæ€æ”¯æŒã€‚  
2. **æ…ç”¨åŸºç±»é™å®šç¬¦**ï¼š  
   ä»…å½“ç¡®å®šä¸éœ€å¤šæ€æˆ–éœ€æ˜ç¡®å±è”½æ´¾ç”Ÿç±»é‡å†™æ—¶ä½¿ç”¨ã€‚  
3. **æ¥å£å¥‘çº¦è®¾è®¡**ï¼š  
   ç¡®ä¿åŸºç±»æ¨¡æ¿çš„æ³›å‹ç‰ˆæœ¬å®šä¹‰å®Œæ•´æ¥å£ï¼Œç‰¹åŒ–ç‰ˆæœ¬ä¸åº”è¿ååŸºæœ¬çº¦å®šã€‚  
4. **ç¼–è¯‘æœŸä¸è¿è¡ŒæœŸåä½œ**ï¼š  
   ç¼–è¯‘å™¨å¯¹æ¨¡æ¿çš„â€œä¸¤é˜¶æ®µæŸ¥æ‰¾â€ï¼ˆæ¨¡æ¿å®šä¹‰æœŸ + å®ä¾‹åŒ–æœŸï¼‰è¦æ±‚å¼€å‘è€…æ˜¾å¼å¤„ç†åç§°ä¾èµ–é—®é¢˜ã€‚

> ğŸ“Œ **Scott Meyers æ ¸å¿ƒè§‚ç‚¹**ï¼š  
> *â€œç»§æ‰¿æ¨¡æ¿åŒ–åŸºç±»æ—¶ï¼Œåç§°æŸ¥æ‰¾è§„åˆ™è¦æ±‚å¼€å‘è€…ä¸»åŠ¨å¼•å¯¼ç¼–è¯‘å™¨â€”â€”è¦ä¹ˆé€šè¿‡ `this->` æˆ– `using` å£°æ˜æ‰¿è¯ºåŸºç±»æ¥å£å­˜åœ¨ï¼Œè¦ä¹ˆé€šè¿‡é™å®šç¬¦æ˜ç¡®è·¯å¾„ã€‚è¿™æ˜¯æ³›å‹ç¼–ç¨‹ä¸é¢å‘å¯¹è±¡äº¤ç»‡æ—¶çš„å¿…è¦å¦¥åã€‚â€*
