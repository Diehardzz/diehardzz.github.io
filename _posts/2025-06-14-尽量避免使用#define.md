---
layout: post
title: Effective C++ æ¡æ¬¾02ï¼šå°½é‡é¿å…ä½¿ç”¨#define
categories: [é˜…è¯»ç¬”è®°, Effective C++]
tag: [Effective C++]
date: '2025-06-14 15:12:32 +0800'
---

## **Effective C++ æ¡æ¬¾02 ï¼šå°½é‡é¿å…ä½¿ç”¨#define**

---

<br/>

> **`#define`çš„æ ¹æœ¬ç¼ºé™·**  
`#define` æ˜¯Cè¯­è¨€é—ç•™çš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œåœ¨C++ä¸­å› å…¶**è„±ç¦»ç¼–è¯‘å™¨ä½œç”¨åŸŸ**å¯¼è‡´è¯¸å¤šé—®é¢˜
 {: .prompt-warning }
1. **æ— ç±»å‹æ£€æŸ¥**ï¼šé¢„å¤„ç†å™¨ä»…åšæ–‡æœ¬æ›¿æ¢ï¼Œå¯èƒ½å¼•å‘ç±»å‹é”™è¯¯ã€‚
  
```cpp
#define PI 3.14
double area = PI * radius * radius;  // è‹¥è¯¯å†™ä¸º PI = "3.14"ï¼Œç¼–è¯‘ä¸æŠ¥é”™ï¼Œè¿è¡Œæ—¶å´©æºƒ
```

2. **ä½œç”¨åŸŸæ±¡æŸ“**ï¼š`#define` å¸¸é‡å…¨å±€å¯è§ï¼Œæ˜“å¼•å‘å‘½åå†²çªã€‚  
3. **è°ƒè¯•å›°éš¾**ï¼šç¬¦å·è¡¨æ—  `#define` åç§°ï¼Œé”™è¯¯æç¤ºä»…æ˜¾ç¤ºæ›¿æ¢åçš„å€¼ï¼ˆå¦‚ `1.653` è€Œé `ASPECT_RATIO`ï¼‰ã€‚  
4. **ä»£ç è†¨èƒ€**ï¼šå¤šæ¬¡ä½¿ç”¨çš„å®ä¼šå¯¼è‡´é‡å¤æ›¿æ¢ï¼Œå¢å¤§ç›®æ ‡æ–‡ä»¶ä½“ç§¯ã€‚  

---

### ğŸ”§ **è§£å†³æ–¹æ¡ˆ1ï¼šç”¨ const æ›¿æ¢å¸¸é‡å®**  
**æ ¸å¿ƒä¼˜åŠ¿**ï¼šç±»å‹å®‰å…¨ + ä½œç”¨åŸŸæ§åˆ¶ + ç¼–è¯‘å™¨ä¼˜åŒ–æ”¯æŒã€‚  
#### **åŸºç¡€ç”¨æ³•**  

```cpp
const double AspectRatio = 1.653;  // æ›¿ä»£ #define ASPECT_RATIO 1.653
```

#### **ç±»ä¸“å±å¸¸é‡**  
éœ€ç»“åˆ `static` é™åˆ¶ä½œç”¨åŸŸå¹¶é¿å…å¤šæ¬¡å®ä¾‹åŒ–ï¼š  

```cpp
class GamePlayer {
private:
    static const int NumTurns = 5;  // å£°æ˜ + åˆå§‹åŒ–ï¼ˆä»…é™æ•´å‹ï¼‰
    int scores[NumTurns];           // ç¼–è¯‘æœŸä½¿ç”¨
};
// éæ•´å‹æˆ–æ—§ç¼–è¯‘å™¨éœ€åœ¨å®ç°æ–‡ä»¶å®šä¹‰ï¼š
// const double GamePlayer::Pi = 3.14;
```

---

### ğŸ¯ **è§£å†³æ–¹æ¡ˆ2ï¼šç”¨ enum æ›¿æ¢æ•´å‹å®**  
**é€‚ç”¨åœºæ™¯**ï¼šç±»å†…æ•´å‹å¸¸é‡ï¼Œä¸”ç¼–è¯‘å™¨ä¸æ”¯æŒç±»å†…åˆå§‹åŒ–ï¼ˆæˆ–éœ€é¿å…å–åœ°å€ï¼‰ã€‚

```cpp
class FileSystem {
public:
    enum { BlockSize = 4096 };      // æšä¸¾å¸¸é‡
    char buffer[BlockSize];         // åˆæ³•ä½¿ç”¨
};
```

**ä¼˜åŠ¿**ï¼š  
- **é›¶å†…å­˜å ç”¨**ï¼šæšä¸¾å€¼ä¸åˆ†é…å­˜å‚¨ç©ºé—´ï¼ˆç±»ä¼¼ `#define`ï¼‰ã€‚  
- **ç¦æ­¢å–åœ°å€**ï¼š`&BlockSize` éæ³•ï¼Œé¿å…æ„å¤–ä¿®æ”¹ã€‚  
- **ç¼–è¯‘æœŸç¡®å®š**ï¼šå¯ç”¨äºæ•°ç»„å¤§å°ç­‰ç¼–è¯‘æœŸä¸Šä¸‹æ–‡ã€‚  

---

### ğŸ› ï¸ **è§£å†³æ–¹æ¡ˆ3ï¼šç”¨ inline æ›¿æ¢å‡½æ•°å®**  
**å‡½æ•°å®çš„ç¼ºé™·**ï¼šå‚æ•°å¤šæ¬¡æ±‚å€¼ + æ— ç±»å‹æ£€æŸ¥ï¼š  
```cpp
#define MAX(a,b) ((a) > (b) ? (a) : (b))
int x = 5, y = 0;
MAX(++x, y);       // xè‡ªå¢ä¸¤æ¬¡ï¼ï¼ˆæ–‡æœ¬æ›¿æ¢åï¼š((++x) > (y) ? (++x) : (y)))
```
**inline å‡½æ•°è§£æ³•**ï¼š

```cpp
template<typename T>
inline T max(const T& a, const T& b) { 
    return a > b ? a : b; 
}  // ç±»å‹å®‰å…¨ + å•æ¬¡æ±‚å€¼
```

**ä¼˜åŠ¿**ï¼š  
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘å™¨æ£€æŸ¥å‚æ•°ç±»å‹ã€‚  
- **å¯è°ƒè¯•**ï¼šè°ƒè¯•å™¨å¯è¿½è¸ªåˆ°å‡½æ•°å®ç°ã€‚  
- **é€‚ç”¨æ³›å‹**ï¼šæ¨¡æ¿æ”¯æŒä»»æ„ç±»å‹å‚æ•°ã€‚  

---

### âš–ï¸ **ä¸‰æ–¹æ¡ˆå¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯**  

| **åœºæ™¯**                 | **æ›¿æ¢æ–¹æ¡ˆ**    | **å…³é”®ä¼˜åŠ¿**                   | **æ³¨æ„äº‹é¡¹**             |
| ------------------------ | --------------- | ------------------------------ | ------------------------ |
| å…¨å±€/å±€éƒ¨å¸¸é‡            | `const`         | ç±»å‹å®‰å…¨ã€ä½œç”¨åŸŸæ§åˆ¶ã€æ”¯æŒè°ƒè¯• | æ•´å‹ç±»å¸¸é‡éœ€ `static`    |
| ç±»å†…æ•´å‹å¸¸é‡ï¼ˆç¼–è¯‘æœŸç”¨ï¼‰ | `enum`          | é›¶å†…å­˜å ç”¨ã€ç¦æ­¢å–åœ°å€         | ä»…é™æ•´å‹                 |
| å‡½æ•°å®ï¼ˆå¦‚ `MAX`ï¼‰       | `inline` + æ¨¡æ¿ | ç±»å‹å®‰å…¨ã€å•æ¬¡æ±‚å€¼ã€æ”¯æŒæ³›å‹   | é¿å…è¿‡åº¦å†…è”å¯¼è‡´ä»£ç è†¨èƒ€ |

---

### ğŸ’¥ **å…¸å‹è¯¯ç”¨æ¡ˆä¾‹**  

1. **ç»§æ‰¿STLç±»æ—¶è¯¯ç”¨å®**ï¼š  
   ```cpp
   class MyString : public std::string {
       #define DEFAULT_SIZE 128  // æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ï¼
   };
   ```
   **æ­£ç¡®åšæ³•**ï¼š  

```cpp
class MyString : public std::string {
private:
    static const size_t DefaultSize = 128;  // é™åˆ¶ä½œç”¨åŸŸ
};
```

2. **å®å‡½æ•°å¯¼è‡´å‰¯ä½œç”¨**ï¼š  

```cpp
#define SQUARE(x) ((x) * (x))
int a = 5;
int b = SQUARE(a++);  // å±•å¼€ä¸º ((a++) * (a++))ï¼Œaè‡ªå¢ä¸¤æ¬¡ï¼
```

   **inlineè§£æ³•**ï¼š
  
```cpp
inline int square(int x) { return x * x; }  // å‚æ•°å€¼ä¼ é€’ï¼Œæ— å‰¯ä½œç”¨
```

---

### âœ… **æœ€ä½³å®è·µæ€»ç»“**  

1. **å½»åº•å¼ƒç”¨ `#define` å®šä¹‰å¸¸é‡æˆ–å‡½æ•°**ï¼Œä¼˜å…ˆä½¿ç”¨ç¼–è¯‘å™¨å¯è§çš„æ›¿ä»£å“ã€‚  
2. **ç±»å†…æ•´å‹å¸¸é‡**ï¼šæ”¯æŒç±»å†…åˆå§‹åŒ–åˆ™ç”¨ `static const`ï¼Œå¦åˆ™ç”¨ `enum hack`ã€‚  
3. **å‡½æ•°å®**ï¼šä¸€å¾‹æ”¹ç”¨ `inline` å‡½æ•°æ¨¡æ¿ï¼Œå…¼é¡¾æ•ˆç‡ä¸å®‰å…¨æ€§ã€‚  
4. **æ—§ä»£ç è¿ç§»**ï¼šé€æ­¥æ›¿æ¢å®ï¼Œå°¤å…¶æ³¨æ„å…¨å±€ä½œç”¨åŸŸçš„å®å®šä¹‰ã€‚  

> *â€œå®å¯ä»¥ç¼–è¯‘å™¨æ›¿æ¢é¢„å¤„ç†å™¨â€* â€”â€” Scott Meyers  

é€šè¿‡æ­¤æ¡æ¬¾ï¼Œå¯æ˜¾è‘—æå‡ä»£ç çš„**ç±»å‹å®‰å…¨æ€§**ã€**å¯ç»´æŠ¤æ€§**å’Œ**è°ƒè¯•ä¾¿åˆ©æ€§**ï¼Œæ˜¯è¿ˆå‘ç°ä»£C++çš„å…³é”®ä¸€æ­¥ã€‚
