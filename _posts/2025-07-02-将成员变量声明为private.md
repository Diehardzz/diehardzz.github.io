---
layout: post
title: Effective C++ æ¡æ¬¾22ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate
categories: [é˜…è¯»ç¬”è®°, Effective C++]
tag: [Effective C++]
date: '2025-07-02 13:41:13 +0800'
---

## **Effective C++ æ¡æ¬¾22 ï¼šå°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivate**

---

<br/>

> è¯¥æ¡æ¬¾é€šè¿‡ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶æå‡ä»£ç çš„å¥å£®æ€§ã€å¯ç»´æŠ¤æ€§å’Œå°è£…æ€§ã€‚
{: .prompt-tip}

### âš™ï¸ **ä¸€ã€ä¸ºä½•ç¦ç”¨publicæˆå‘˜å˜é‡ï¼Ÿ**  

publicæˆå‘˜å˜é‡ç ´åå°è£…æ€§ï¼Œå¼•å‘ä¸‰ç±»æ ¸å¿ƒé—®é¢˜ï¼š  
1. **è¯­æ³•ä¸€è‡´æ€§ä¸§å¤±**  
   - è‹¥æˆå‘˜å˜é‡å¯è¢«ç›´æ¥è®¿é—®ï¼Œå®¢æˆ·ä»£ç éœ€åŒºåˆ†â€œç›´æ¥è®¿é—®å˜é‡â€å’Œâ€œè°ƒç”¨æˆå‘˜å‡½æ•°â€ä¸¤ç§è¯­æ³•ï¼Œå¢åŠ è®¤çŸ¥è´Ÿæ‹…ã€‚ä¾‹å¦‚ï¼š  
     ```cpp
     class Widget {
     public:
         int id;          // publicå˜é‡
         std::string getName() const; // publicå‡½æ•°
     };
     Widget w;
     w.id = 1;            // ç›´æ¥è®¿é—®å˜é‡
     w.getName();         // é€šè¿‡å‡½æ•°è®¿é—®
     ```  
     ç»Ÿä¸€ä½¿ç”¨å‡½æ•°æ¥å£ï¼ˆå¦‚`getId()`ã€`setName()`ï¼‰å¯ä¿è¯æ‰€æœ‰äº¤äº’é€»è¾‘ä¸€è‡´ã€‚

2. **è®¿é—®æ§åˆ¶ç²’åº¦ç¼ºå¤±**  
   - publicå˜é‡æ— æ³•åŒºåˆ†è¯»å†™æƒé™ï¼ˆå¦‚åªè¯»ã€åªå†™ï¼‰ã€‚é€šè¿‡privateå˜é‡+å‡½æ•°æ¥å£ï¼Œå¯ç²¾ç»†åŒ–æ§åˆ¶ï¼š  
     ```cpp
     class AccessLevels {
     public:
         int getReadOnly() const { return readOnly; }  // åªè¯»
         void setWriteOnly(int v) { writeOnly = v; }   // åªå†™
         int getReadWrite() const { return readWrite; } // å¯è¯»
         void setReadWrite(int v) { readWrite = v; }    // å¯å†™
     private:
         int noAccess;   // ç¦æ­¢è®¿é—®
         int readOnly;   // åªè¯»
         int readWrite;  // è¯»å†™
         int writeOnly;  // åªå†™
     };
     ```  
     é¿å…æ— å…³ä»£ç æ„å¤–ä¿®æ”¹å…³é”®æ•°æ®ã€‚

3. **å°è£…æ€§ç ´åå¯¼è‡´å®ç°åƒµåŒ–**  
   - è‹¥æˆå‘˜å˜é‡æš´éœ²ï¼Œä¸€æ—¦ä¿®æ”¹å…¶ç±»å‹æˆ–è®¡ç®—é€»è¾‘ï¼Œæ‰€æœ‰ä¾èµ–è¯¥å˜é‡çš„å®¢æˆ·ä»£ç å‡éœ€é‡å†™ã€‚ä¾‹å¦‚ï¼š  
     ```cpp
     class SpeedDataCollection {
     public:
         void addValue(int speed);
         double averageSoFar() const; // å®ç°å¯åˆ‡æ¢ï¼šå®æ—¶è®¡ç®— or ç¼“å­˜å¹³å‡å€¼
     private:
         std::vector<int> speeds; // å¯æ”¹ä¸ºç¼“å­˜å˜é‡è€Œä¸å½±å“æ¥å£
     };
     ```  
     é€šè¿‡privateå°è£…ï¼Œå†…éƒ¨å¯è‡ªç”±ä¼˜åŒ–ï¼ˆå¦‚ç”¨ç¼“å­˜æ›¿ä»£å®æ—¶è®¡ç®—ï¼‰ï¼Œå®¢æˆ·ä»£ç æ— éœ€æ„ŸçŸ¥ã€‚

---

### âš ï¸ **äºŒã€ä¸ºä½•protectedä¸æ¯”publicæ›´å®‰å…¨ï¼Ÿ**  

protectedçœ‹ä¼¼æä¾›å°è£…ï¼Œå®åˆ™ä¸publicåŒæ ·å±é™©ï¼š  
- **å¯¹æ´¾ç”Ÿç±»çš„ç ´åæ€§ä¿®æ”¹**  
  ä¿®æ”¹åŸºç±»çš„protectedæˆå‘˜æ—¶ï¼Œæ‰€æœ‰æ´¾ç”Ÿç±»å‡éœ€è°ƒæ•´ï¼Œå½±å“èŒƒå›´ç”šè‡³å¤§äºpublicå˜é‡ï¼ˆpublicä»…å½±å“å¤–éƒ¨å®¢æˆ·ï¼Œprotectedå½±å“æ‰€æœ‰å­ç±»ï¼‰ã€‚  
- **å°è£…æ€§å®è´¨ç­‰åŒpublic**  
  protectedæˆå‘˜ä»å¯¹æ´¾ç”Ÿç±»å¯è§ï¼Œæ´¾ç”Ÿç±»å¯ç›´æ¥ä¿®æ”¹å…¶å€¼ï¼ŒåŸºç±»å¤±å»å¯¹å…¶çº¦æŸèƒ½åŠ›ã€‚**å°è£…æ€§åªæœ‰ä¸¤ç§çŠ¶æ€ï¼šprivateï¼ˆå°è£…ï¼‰å’Œå…¶ä»–ï¼ˆä¸å°è£…ï¼‰**ã€‚

---

### ğŸ›¡ï¸ **ä¸‰ã€privateæˆå‘˜çš„æ ¸å¿ƒä¼˜åŠ¿**  

å°†æˆå‘˜å˜é‡å£°æ˜ä¸ºprivateï¼Œå¸¦æ¥ä¸‰é‡è®¾è®¡è‡ªç”±åº¦ï¼š  

1. **å®ç°å¼¹æ€§ï¼ˆImplementation Flexibilityï¼‰**  
   - å¯åœ¨è¯»å†™æ—¶æ³¨å…¥é¢å¤–é€»è¾‘ï¼š  
     - **é€šçŸ¥æœºåˆ¶**ï¼šå˜é‡ä¿®æ”¹æ—¶è‡ªåŠ¨è§¦å‘äº‹ä»¶ï¼ˆå¦‚Observeræ¨¡å¼ï¼‰ã€‚  
     - **æ¡ä»¶æ ¡éªŒ**ï¼šsetterå‡½æ•°ä¸­éªŒè¯å‚æ•°æœ‰æ•ˆæ€§ï¼ˆå¦‚`if (value > 0) ...`ï¼‰ã€‚  
     - **å»¶è¿Ÿè®¡ç®—**ï¼šä»…åœ¨éœ€è¦æ—¶è®¡ç®—è¡ç”Ÿæ•°æ®ï¼ˆå¦‚ä¸Šè¿°`averageSoFar()`ï¼‰ã€‚

2. **çŠ¶æ€ä¸€è‡´æ€§ï¼ˆState Consistencyï¼‰**  
   - é€šè¿‡å‡½æ•°æ¥å£ç¡®ä¿å¯¹è±¡å§‹ç»ˆå¤„äºæœ‰æ•ˆçŠ¶æ€ã€‚ä¾‹å¦‚ï¼š  
     ```cpp
     class Date {
     public:
         void setMonth(int m) { 
             if (m >= 1 && m <= 12) month = m; // æ ¡éªŒé€»è¾‘
         }
     private:
         int month; // ä¿è¯monthâˆˆ[1,12]
     };
     ```  
     é¿å…publicå˜é‡è¢«ä»»æ„èµ‹æ— æ•ˆå€¼ã€‚

3. **äºŒè¿›åˆ¶å…¼å®¹æ€§ï¼ˆBinary Compatibilityï¼‰**  
   - ä¿®æ”¹privateæˆå‘˜çš„å†…å­˜å¸ƒå±€ï¼ˆå¦‚å¢åˆ æˆå‘˜ï¼‰æ—¶ï¼Œåªéœ€é‡æ–°ç¼–è¯‘å½“å‰ç±»ï¼Œå®¢æˆ·ä»£ç æ— éœ€é‡æ–°é“¾æ¥ã€‚public/protectedæˆå‘˜å˜æ›´åˆ™éœ€å…¨é‡é‡ç¼–è¯‘ã€‚

---

### ğŸ’¡ **å››ã€å»¶ä¼¸å®è·µï¼šä¸ç›¸å…³æ¡æ¬¾çš„å…³è”**  

- **æ¡æ¬¾23ï¼ˆå®ä»¥non-memberå‡½æ•°æ›¿æ¢memberå‡½æ•°ï¼‰**  
  é€šè¿‡non-memberå‡½æ•°è®¿é—®privateæˆå‘˜ï¼Œæ¯”memberå‡½æ•°**å°è£…æ€§æ›´é«˜**ï¼ˆå‡å°‘è®¿é—®ç§æœ‰æ•°æ®çš„å‡½æ•°æ•°é‡ï¼‰ã€‚  
- **æ¡æ¬¾18ï¼ˆæ¥å£å®Œæ•´ä¸”æœ€å°åŒ–ï¼‰**  
  privateæˆå‘˜å¼ºåˆ¶é€šè¿‡æœ‰é™æ¥å£è®¿é—®ï¼Œè‡ªç„¶ä¿ƒä½¿æ¥å£ç²¾ç®€ã€‚  
- **Pimplæƒ¯ç”¨æ³•ï¼ˆæ¡æ¬¾22çš„ç°ä»£æ‰©å±•ï¼‰**  
  ç»“åˆ`std::unique_ptr`å°†ç§æœ‰æ•°æ®å®Œå…¨éšè—äºå®ç°ç±»ä¸­ï¼Œè¿›ä¸€æ­¥é™ä½ç¼–è¯‘ä¾èµ–ï¼š  
  ```cpp
  // widget.h
  class Widget {
  public:
      Widget();
      ~Widget(); // éœ€åœ¨å®ç°æ–‡ä»¶ä¸­å®šä¹‰ï¼ˆè§æ¡æ¬¾22ï¼‰
  private:
      struct Impl;           // å‰ç½®å£°æ˜
      std::unique_ptr<Impl> pImpl; // æŒ‡å‘å®ç°ç±»
  };
  ```  
  åœ¨å®ç°æ–‡ä»¶`widget.cpp`ä¸­å®šä¹‰`Impl`å’Œææ„å‡½æ•°ï¼Œé¿å…ä¸å®Œæ•´ç±»å‹é—®é¢˜ã€‚

---

### ğŸ’ **æ€»ç»“ï¼šprivateæˆå‘˜çš„è®¾è®¡å“²å­¦**  

| **å…³é”®åŸåˆ™**                 | **åº•å±‚é€»è¾‘**                                                         |
| ---------------------------- | -------------------------------------------------------------------- |
| **ç¦ç”¨public/protectedæˆå‘˜** | æ•°æ®æš´éœ² == å°è£…å¤±æ•ˆ â†’ ä»£ç è„†å¼±æ€§ â†‘                                  |
| **ç»Ÿä¸€é€šè¿‡å‡½æ•°æ¥å£è®¿é—®**     | è¯­æ³•ä¸€è‡´æ€§ + è®¿é—®æ§åˆ¶ç²’åº¦åŒ–ï¼ˆåªè¯»/è¯»å†™/å”¯å†™ï¼‰                        |
| **å°è£…å³è‡ªç”±**               | å†…éƒ¨å®ç°å¯ä»»æ„æ¼”è¿›ï¼ˆç¼“å­˜/è®¡ç®—/é€šçŸ¥ï¼‰ï¼Œå®¢æˆ·ä»£ç 0ä¿®æ”¹ â†’ ç³»ç»Ÿå¯ç»´æŠ¤æ€§ â†‘ |

> â€œ**private** æ˜¯å°è£…çš„å¤§é—¨ï¼Œé—¨åçš„ä¸–ç•Œç”±ç±»ä½œè€…æŒæ§ï¼›**public/protected** æ˜¯æ•°æ®çš„æ³„æ´ªå£ï¼Œæ´ªæ°´ç»ˆå°†å†²å®è®¾è®¡çš„å ¤åã€‚â€ â€”â€” æ¡æ¬¾22çš„æ ¸å¿ƒéšå–»ã€‚
