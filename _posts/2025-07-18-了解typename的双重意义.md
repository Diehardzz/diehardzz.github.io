---
layout: post
title: Effective C++ æ¡æ¬¾42ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰
categories: [é˜…è¯»ç¬”è®°, Effective C++]
tag: [Effective C++]
date: '2025-07-18 14:56:13 +0800'
---

## **Effective C++ æ¡æ¬¾42 ï¼šäº†è§£typenameçš„åŒé‡æ„ä¹‰**

---

<br/>

### âš™ï¸ **ä¸€ã€typename çš„æ ¸å¿ƒä½œç”¨ï¼šæ¨¡æ¿å‚æ•°å£°æ˜**

åœ¨å£°æ˜æ¨¡æ¿å‚æ•°æ—¶ï¼Œ`typename` å’Œ `class` **å®Œå…¨ç­‰ä»·**ï¼Œå¯äº’æ¢ä½¿ç”¨ï¼š
```cpp
template <typename T> class Widget;  // ç­‰ä»·äº
template <class T> class Widget;     // ä¸¤è€…æ— åŒºåˆ«
```
**æ„ä¹‰**ï¼šæ­¤å¤„ `typename`/`class` ä»…è¡¨ç¤º `T` æ˜¯ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œä¸æ¶‰åŠå…¶ä»–è¯­ä¹‰ã€‚

---

### âš ï¸ **äºŒã€åµŒå¥—ä»å±ç±»å‹åç§°çš„è§£æéš¾é¢˜**

#### 1. **å…³é”®æ¦‚å¿µ**

- **ä»å±åç§°ï¼ˆDependent Nameï¼‰**ï¼šåç§°ä¾èµ–äºæ¨¡æ¿å‚æ•°ï¼ˆå¦‚ `T::const_iterator`ï¼‰ã€‚
- **åµŒå¥—ä»å±ç±»å‹åç§°ï¼ˆNested Dependent Type Nameï¼‰**ï¼šä»å±åç§°ä¸”åµŒå¥—åœ¨ç±»ä½œç”¨åŸŸå†…ï¼ˆå¦‚ `C::iterator`ï¼‰ã€‚
  
#### 2. **ç¼–è¯‘å™¨é»˜è®¤è¡Œä¸º**

ç¼–è¯‘å™¨åœ¨è§£ææ¨¡æ¿æ—¶**é»˜è®¤å‡è®¾åµŒå¥—ä»å±åç§°ä¸æ˜¯ç±»å‹**ï¼ˆé™¤éæ˜¾å¼æŒ‡å®šï¼‰ï¼š
```cpp
template <typename C>
void print(const C& container) {
    C::const_iterator iter(container.begin()); // ç¼–è¯‘é”™è¯¯ï¼
}
```
**é—®é¢˜**ï¼š`C::const_iterator` å¯èƒ½æ˜¯ç±»å‹ï¼ˆå¦‚è¿­ä»£å™¨ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯é™æ€æˆå‘˜å˜é‡ã€‚ç¼–è¯‘å™¨æ— æ³•ç¡®å®šå…¶è¯­ä¹‰ï¼Œå› æ­¤å‡è®¾å…¶ä¸º**éç±»å‹**ï¼ˆå˜é‡ï¼‰ã€‚

---

### ğŸ”§ **ä¸‰ã€è§£å†³æ–¹æ¡ˆï¼šæ˜¾å¼æ ‡è¯†ç±»å‹**

é€šè¿‡ `typename` æ˜ç¡®å‘ŠçŸ¥ç¼–è¯‘å™¨åµŒå¥—ä»å±åç§°æ˜¯ç±»å‹ï¼š
```cpp
template <typename C>
void print(const C& container) {
    typename C::const_iterator iter(container.begin()); // æ­£ç¡®ï¼šæ˜¾å¼å£°æ˜ä¸ºç±»å‹
}
```
**è§„åˆ™**ï¼š  
> ä»»ä½•åœ¨æ¨¡æ¿ä¸­å¼•ç”¨çš„**åµŒå¥—ä»å±ç±»å‹åç§°**ï¼Œå¿…é¡»åœ¨å…¶å‰åŠ  `typename`ï¼ˆé™¤éåœ¨åŸºç±»åˆ—è¡¨æˆ–æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ä¸­ï¼‰ã€‚

---

### ğŸš« **å››ã€ä¾‹å¤–åœºæ™¯**

`typename` ä¸å¯ç”¨äºä»¥ä¸‹ä¸¤ç§ä¸Šä¸‹æ–‡ï¼ˆå³ä½¿æ¶‰åŠåµŒå¥—ä»å±ç±»å‹ï¼‰ï¼š
1. **åŸºç±»åˆ—è¡¨ï¼ˆBase Class Listï¼‰**  
   ```cpp
   template <typename T>
   class Derived : public Base<T>::Nested {  // æ­¤å¤„ä¸å¯åŠ  typenameï¼
   };
   ```
2. **æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼ˆMember Initialization Listï¼‰**  
   ```cpp
   template <typename T>
   Derived(int x) : Base<T>::Nested(x) { ... }  // æ­¤å¤„ä¸å¯åŠ  typenameï¼
   ```
**åŸå› **ï¼šç¼–è¯‘å™¨åœ¨è¿™äº›ä½ç½®å·²æ˜ç¡®çŸ¥é“åç§°æ˜¯ç±»å‹ã€‚

---

### ğŸ’¡ **äº”ã€åº”ç”¨åœºæ™¯ä¸æŠ€å·§**

#### 1. **Traits æŠ€æœ¯ä¸­çš„ typedef**

éœ€ç”¨ `typename` æå– traits ä¸­çš„ç±»å‹ï¼š
```cpp
template <typename Iter>
void process(Iter iter) {
    typedef typename std::iterator_traits<Iter>::value_type ValueType;
    ValueType temp(*iter);  // æ­£ç¡®è§£æ value_type ä¸ºç±»å‹
}
```


#### 2. **é¿å…æ­§ä¹‰çš„ä»£ç è®¾è®¡**

è‹¥ç±»è®¾è®¡å¯èƒ½å¼•èµ·æ­§ä¹‰ï¼ˆå¦‚ `T::const_iterator` å¯èƒ½æ˜¯å˜é‡æˆ–ç±»å‹ï¼‰ï¼Œåº”é€šè¿‡å‘½åè§„èŒƒï¼ˆå¦‚ç±»å‹ç”¨ `Type` åç¼€ï¼‰å‡å°‘æ··æ·†ï¼š
```cpp
class Container {
public:
    using iterator_type = ...;  // æ˜ç¡®ç±»å‹åˆ«å
    static int iterator;         // éç±»å‹æˆå‘˜
};
```

---

### ğŸ“Œ **æ€»ç»“ä¸å‡†åˆ™**

1. **æ¨¡æ¿å‚æ•°å£°æ˜**ï¼š`typename` ä¸ `class` ç­‰ä»·ï¼Œä»»é€‰å…¶ä¸€ã€‚  
2. **åµŒå¥—ä»å±ç±»å‹**ï¼šå¿…é¡»ç”¨ `typename` å‰ç¼€æ ‡è¯†ï¼ˆä¾‹å¤–ï¼šåŸºç±»åˆ—è¡¨/æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼‰ã€‚  
3. **ä»£ç å®‰å…¨**ï¼šåœ¨æ³›å‹ç¼–ç¨‹ä¸­æ˜¾å¼ä½¿ç”¨ `typename` å¯é¿å…éšæ™¦çš„ç¼–è¯‘é”™è¯¯ã€‚  
4. **è®¾è®¡åŸåˆ™**ï¼šé€šè¿‡æ¸…æ™°çš„ç±»å‹å‘½åè§„èŒƒå‡å°‘å¯¹ `typename` çš„ä¾èµ–ã€‚  

> â€œ**ç†è§£ `typename` çš„åŒé‡æ„ä¹‰ï¼Œæ˜¯ç¼–å†™å¥å£®æ¨¡æ¿ä»£ç çš„åŸºçŸ³**â€â€”â€”Scott Meyersã€‚
