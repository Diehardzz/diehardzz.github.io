---
layout: post
title: Effective C++ æ¡æ¬¾38ï¼šé€šè¿‡å¤åˆæ¨¡å¡‘å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€
categories: [é˜…è¯»ç¬”è®°, Effective C++]
tag: [Effective C++]
date: '2025-07-11 23:25:39 +0800'
---

## **Effective C++ æ¡æ¬¾38 ï¼šé€šè¿‡å¤åˆæ¨¡å¡‘å‡ºhas-aæˆ–â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€**

---

<br/>

### ğŸ” **ä¸€ã€å¤åˆçš„æ ¸å¿ƒæ¦‚å¿µä¸æœ¬è´¨**

#### 1. **ä»€ä¹ˆæ˜¯å¤åˆï¼Ÿ**

å¤åˆï¼ˆcompositionï¼‰æ˜¯ä¸€ç§ç±»å…³ç³»ï¼ŒæŒ‡ä¸€ä¸ªç±»çš„å¯¹è±¡åŒ…å«å…¶ä»–ç±»å¯¹è±¡ä½œä¸ºæˆå‘˜å˜é‡ï¼š

```cpp
class Address { /*...*/ };
class PhoneNumber { /*...*/ };

class Person {
private:
    std::string name;       // åŒ…å«stringå¯¹è±¡
    Address address;        // åŒ…å«Addresså¯¹è±¡
    PhoneNumber mobilePhone;// åŒ…å«PhoneNumberå¯¹è±¡
};
```
åŒä¹‰è¯åŒ…æ‹¬ï¼šåˆ†å±‚ï¼ˆlayeringï¼‰ã€å†…å«ï¼ˆcontainmentï¼‰ã€èšåˆï¼ˆaggregationï¼‰ã€å†…åµŒï¼ˆembeddingï¼‰ã€‚

#### 2. **å¤åˆçš„ä¸¤ç§è¯­ä¹‰**

- **Has-aï¼ˆæœ‰ä¸€ä¸ªï¼‰**ï¼šç”¨äºæè¿°**åº”ç”¨åŸŸå¯¹è±¡**ï¼ˆç°å®ä¸–ç•Œæ¦‚å¿µçš„æŠ½è±¡ï¼‰ï¼Œè¡¨ç¤ºæ•´ä½“ä¸éƒ¨åˆ†çš„æ‰€å±å…³ç³»ã€‚  
  *ä¾‹å¦‚ï¼š`Person` æ‹¥æœ‰ï¼ˆhas-aï¼‰åå­—ã€åœ°å€å’Œç”µè¯å·ç ã€‚*
- **Is-implemented-in-terms-ofï¼ˆæ ¹æ®æŸç‰©å®ç°å‡ºï¼‰**ï¼šç”¨äº**å®ç°åŸŸå¯¹è±¡**ï¼ˆåº•å±‚å®ç°å·¥å…·ï¼‰ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»åˆ©ç”¨å¦ä¸€ä¸ªç±»çš„åŠŸèƒ½å®ç°è‡ªèº«é€»è¾‘ã€‚  
  *ä¾‹å¦‚ï¼šè‡ªå®šä¹‰ `Set` åŸºäº `std::list` å®ç°ï¼Œä½† `Set` ä¸æ˜¯ä¸€ç§ `List`ã€‚*

---

### âš ï¸ **äºŒã€å¤åˆ vs Publicç»§æ‰¿ï¼šæœ¬è´¨å·®å¼‚ä¸è®¾è®¡é™·é˜±**

#### 1. **Publicç»§æ‰¿çš„è¯­ä¹‰ï¼šIs-a**

- Publicç»§æ‰¿è¡¨ç¤ºæ´¾ç”Ÿç±»æ˜¯ä¸€ç§åŸºç±»ï¼ˆDerived **is-a** Baseï¼‰ï¼Œå¿…é¡»æ»¡è¶³**é‡Œæ°æ›¿æ¢åŸåˆ™**ã€‚  
- **é”™è¯¯ç¤ºä¾‹**ï¼šå°è¯•ç”¨publicç»§æ‰¿å®ç° `Set` å’Œ `List` çš„å…³ç³»ï¼š  
  ```cpp
  template<typename T>
  class Set : public std::list<T> { /*...*/ }; // é”™è¯¯ï¼Setä¸æ˜¯ä¸€ç§List
  ```
  **é—®é¢˜**ï¼šSetè¦æ±‚å…ƒç´ å”¯ä¸€ï¼Œä½†Listå…è®¸é‡å¤å…ƒç´ ã€‚è‹¥é€šè¿‡åŸºç±»æŒ‡é’ˆæ“ä½œSetï¼Œå¯èƒ½æ’å…¥é‡å¤å…ƒç´ ï¼Œç ´åSetä¸å˜æ€§ã€‚

#### 2. **å¤åˆçš„è¯­ä¹‰ï¼šè§£è€¦æ¥å£ä¸å®ç°**

- å¤åˆä¸è¦æ±‚æ¥å£ä¸€è‡´ï¼Œåªéœ€åœ¨å†…éƒ¨åˆ©ç”¨æˆå‘˜å¯¹è±¡çš„åŠŸèƒ½ã€‚  
- **æ­£ç¡®å®ç° `Set`**ï¼š  
  ```cpp
  template<typename T>
  class Set {
  public:
    bool member(const T& item) const;
    void insert(const T& item);
    // ... å…¶ä»–æ¥å£
  private:
    std::list<T> rep; // åŸºäºlistå®ç°
  };

  template<typename T>
  void Set<T>::insert(const T& item) {
    if (!member(item)) rep.push_back(item); // å¼ºåˆ¶å”¯ä¸€æ€§
  }
  ```
  **ä¼˜åŠ¿**ï¼š  
  - å°è£…å®ç°ç»†èŠ‚ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥æ“ä½œåº•å±‚listï¼›  
  - å¯è‡ªç”±æ›¿æ¢åº•å±‚å®¹å™¨ï¼ˆå¦‚æ”¹ç”¨vectorï¼‰è€Œä¸å½±å“å®¢æˆ·ç«¯ä»£ç ã€‚

---

### ğŸ’¡ **ä¸‰ã€åŒºåˆ†ä¸¤ç§å¤åˆè¯­ä¹‰çš„å…³é”®åœºæ™¯**

#### 1. **åº”ç”¨åŸŸï¼ˆHas-aï¼‰**

- **å¯¹è±¡ä»£è¡¨ç°å®æ¦‚å¿µ**ï¼šå¦‚äººã€åœ°å€ã€è®¢å•ç­‰ã€‚  
- **å…³ç³»æœ¬è´¨**ï¼šæ•´ä½“ç”±éƒ¨åˆ†ç»„æˆï¼Œéƒ¨åˆ†ä¸å±äºæ•´ä½“æ—¶æ— ç‹¬ç«‹æ„ä¹‰ã€‚  
  *ä¾‹å¦‚ï¼š`Person` é”€æ¯æ—¶ï¼Œå…¶åŒ…å«çš„ `Address` å¯¹è±¡ä¹Ÿéšä¹‹é”€æ¯ã€‚*

#### 2. **å®ç°åŸŸï¼ˆIs-implemented-in-terms-ofï¼‰**

- **å¯¹è±¡ä»£è¡¨å®ç°å·¥å…·**ï¼šå¦‚ç¼“å†²åŒºã€äº’æ–¥é”ã€æŸ¥æ‰¾æ ‘ç­‰ã€‚  
- **å…³ç³»æœ¬è´¨**ï¼šä¸€ä¸ªç±»å€Ÿç”¨å¦ä¸€ä¸ªç±»çš„åŠŸèƒ½å®ç°è‡ªèº«ç®—æ³•ï¼Œä½†ä¸¤è€…æ— é€»è¾‘æ‰€å±å…³ç³»ã€‚  
  *ä¾‹å¦‚ï¼š`Set` å€Ÿç”¨ `List` çš„å­˜å‚¨èƒ½åŠ›ï¼Œä½† `List` å¯ç‹¬ç«‹å­˜åœ¨ã€‚*

---

### âš™ï¸ **å››ã€å¤åˆä¸Privateç»§æ‰¿çš„æƒè¡¡**

> **privateç»§æ‰¿**çš„æ´¾ç”Ÿç±»ä¸­ï¼ŒåŸºç±»çš„æ‰€æœ‰**publicæˆå‘˜**å’Œ**protectedæˆå‘˜**éƒ½å°†è½¬ä¸ºæ´¾ç”Ÿç±»çš„**privateæˆå‘˜**ï¼
{: .prompt-info}

å°½ç®¡å¤åˆå¯æ»¡è¶³å¤§å¤šæ•°â€œæ ¹æ®æŸç‰©å®ç°å‡ºâ€çš„éœ€æ±‚ï¼Œä½† **privateç»§æ‰¿** åœ¨ç‰¹å®šåœºæ™¯æ›´é€‚ç”¨ï¼š

| **åœºæ™¯**                    | **å¤åˆ** | **Privateç»§æ‰¿** |
| --------------------------- | -------- | --------------- |
| éœ€è¦è®¿é—®åŸºç±»protectedæˆå‘˜   | âŒ        | âœ…               |
| éœ€é‡å†™åŸºç±»è™šå‡½æ•°            | âŒ        | âœ…               |
| ç©ºé—´ä¼˜åŒ–ï¼ˆEBOï¼Œç©ºåŸºç±»ä¼˜åŒ–ï¼‰ | âŒ        | âœ…               |
| ä¸€èˆ¬æ€§å®ç°å¤ç”¨              | âœ…        | âŒ               |

#### **ä½•æ—¶é€‰æ‹©Privateç»§æ‰¿ï¼Ÿ**

1. **è®¿é—®protectedæˆå‘˜æˆ–é‡å†™è™šå‡½æ•°**  
   *ä¾‹å¦‚ï¼šå®šåˆ¶å®šæ—¶å™¨è¡Œä¸ºæ—¶éœ€é‡å†™ `Timer::onTick()`ï¼š*

   ```cpp
   class Widget : private Timer {
   private:
     void onTick() const override; // é‡å†™è™šå‡½æ•°
   };
   ```

2. **ç©ºåŸºç±»ä¼˜åŒ–ï¼ˆEBOï¼‰**  
   å½“åŸºç±»æ— æˆå‘˜å˜é‡æ—¶ï¼Œprivateç»§æ‰¿å¯é¿å…é¢å¤–å†…å­˜å¼€é”€ï¼š

   ```cpp
   class Empty {}; // ç©ºç±»
   class Widget : private Empty { /* æ— é¢å¤–å¼€é”€ */ };
   class Holder { Empty e; int x; }; // å¯èƒ½å ç”¨é¢å¤–å­—èŠ‚
   ```
   **æ³¨æ„**ï¼šEBOä»…é€‚ç”¨äºå•ä¸€ç»§æ‰¿ã€‚

---

### ğŸ§© **äº”ã€å¤åˆçš„è®¾è®¡ä¼˜åŠ¿**

1. **å°è£…æ€§**  
   éšè—å®ç°ç»†èŠ‚ï¼Œä»…æš´éœ²å¿…è¦æ¥å£ã€‚`Set` çš„å®¢æˆ·ç«¯æ— éœ€çŸ¥æ‚‰ `std::list` çš„å­˜åœ¨ã€‚
2. **ç¼–è¯‘ä¾èµ–æœ€å°åŒ–**  
   å¯é€šè¿‡å‰å‘å£°æ˜å‡å°‘å¤´æ–‡ä»¶åŒ…å«ï¼ŒåŠ é€Ÿç¼–è¯‘ã€‚
3. **çµæ´»æ€§**  
   å¯åŠ¨æ€æ›¿æ¢åº•å±‚å®ç°ï¼ˆå¦‚ç­–ç•¥æ¨¡å¼ï¼‰ï¼Œè€Œç»§æ‰¿åœ¨ç¼–è¯‘æ—¶ç»‘å®šã€‚
4. **æ¥å£éš”ç¦»**  
   é¿å…ç»§æ‰¿ä½“ç³»å¸¦æ¥çš„æ¥å£æ±¡æŸ“ï¼ˆå¦‚ `Set` æ— éœ€å®ç° `List` çš„æ‰€æœ‰æ–¹æ³•ï¼‰ã€‚

---

### ğŸ’ **å…­ã€æ€»ç»“ä¸å®è·µåŸåˆ™**

1. **ä¼˜å…ˆé€‰æ‹©å¤åˆè€Œéç»§æ‰¿**ï¼š  
   é™¤ééœ€è¦å¤šæ€æˆ–å¿…é¡»è®¿é—®protectedæˆå‘˜ï¼Œå¦åˆ™å¤åˆæ˜¯æ›´å®‰å…¨ã€æ›´çµæ´»çš„é€‰æ‹©ã€‚
2. **ä¸¥æ ¼åŒºåˆ†å…³ç³»è¯­ä¹‰**ï¼š  
   - `is-a` â†’ **publicç»§æ‰¿**  
   - `has-a` â†’ **å¤åˆï¼ˆåº”ç”¨åŸŸï¼‰**  
   - `is-implemented-in-terms-of` â†’ **å¤åˆæˆ–privateç»§æ‰¿ï¼ˆå®ç°åŸŸï¼‰**  
3. **è­¦æƒ•publicç»§æ‰¿æ»¥ç”¨**ï¼š  
   è‹¥æ´¾ç”Ÿç±»æ— æ³•å®Œå…¨æ›¿ä»£åŸºç±»ï¼ˆå¦‚ `Set` ä¸ `List`ï¼‰ï¼Œåˆ™ç»§æ‰¿å¿…å®šæ˜¯é”™è¯¯çš„ã€‚

> ğŸ“Œ **Scott Meyers çš„å¿ å‘Š**ï¼š  
> *â€œPublicç»§æ‰¿å¡‘æ¨¡is-aå…³ç³»ï¼Œå¤åˆå¡‘æ¨¡has-aæˆ–is-implemented-in-terms-ofå…³ç³»ã€‚æ··æ·†äºŒè€…å°†å¯¼è‡´è®¾è®¡æ¼æ´ï¼Œå¦‚åŒåœ¨ä»£ç ä¸­åŸ‹ä¸‹å®šæ—¶ç‚¸å¼¹ã€‚â€*
